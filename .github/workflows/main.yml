name: Postman Collection Workflow

on:
  push:
    branches: [main]
  workflow_dispatch:
  schedule:
    - cron : 30 02 * * * # 8 am IST
    - cron : 00 14 * * * #7:30 PM IST

jobs:
  run-postman-test:
   runs-on: ec2-github-runner

   steps:
     - name: Checkout the code
       uses: actions/checkout@v4

     - name: Install node js and npm
       uses: actions/checkout@v4
       with:
         node-version: '22'
         
     - name: Install newman and HTML-extra globally
       run: |
             npm install -g newman
             npm install -g newman-reporter-htmlextra

     - name: Run the postaman colletion with newman
       run: |
            newman run 'Inwarranty - Flow Collection.postman_collection.json' \
            -e QA.postman_environment.json \
            -d testdata.csv \
            -r cli,htmlextra \
            --reporter-htmlextra-export ./newman/index.html
            
     - name: Newman Report
       if: always()
       uses: actions/upload-artifact@v4.6.2
       with:
         name: Newman Report
         path: newman/*.html
         
     - name: Creating GITHub page branch
       if: always()
       uses: peaceiris/actions-gh-pages@v4.0.0
       with:
         github_token: ${{ secrets.GITHUB_TOKEN }}
         publish_dir: newman/
            
            
              
           
           
     
